<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>طلبات الركاب المتاحة - عالواهس</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Tajawal', sans-serif;
      }

      body {
        background: #f5f6fa;
      }

      .navbar {
        background: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .navbar-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2d3436;
      }

      .nav-links {
        display: flex;
        gap: 1.5rem;
      }

      .nav-links a {
        text-decoration: none;
        color: #636e72;
        font-weight: 500;
        transition: color 0.3s ease;
      }

      .nav-links a:hover {
        color: #2d3436;
      }

      .nav-links a.active {
        color: #FF8C00;
      }

      .container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .page-title {
        font-size: 1.8rem;
        color: #2d3436;
      }

      .filters {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
      }

      .filter-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }

      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .filter-group label {
        font-weight: 500;
        color: #2d3436;
      }

      .filter-group input {
        padding: 0.8rem;
        border: 1px solid #dfe6e9;
        border-radius: 6px;
        font-size: 1rem;
      }

      .requests-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
      }

      .request-card {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .request-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .request-date {
        color: #636e72;
        font-size: 0.9rem;
      }

      .request-route {
        margin-bottom: 1rem;
      }

      .route-point {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
      }

      .route-point i {
        color: #FF8C00;
        font-size: 1.2rem;
      }

      .request-details {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        color: #636e72;
        font-size: 0.9rem;
      }

      .whatsapp-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        background: #25D366;
        color: white;
        padding: 0.8rem;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .whatsapp-btn:hover {
        background: #128C7E;
        transform: translateY(-2px);
      }

      .no-requests {
        text-align: center;
        padding: 3rem;
        color: #636e72;
      }

      .no-requests i {
        font-size: 3rem;
        color: #b2bec3;
        margin-bottom: 1rem;
      }

      @media (max-width: 768px) {
        .navbar-content {
          flex-direction: column;
          gap: 1rem;
        }

        .page-header {
          flex-direction: column;
          gap: 1rem;
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <div class="navbar-content">
        <div class="logo">عالواهس</div>
        <div class="nav-links">
          <a href="index.html">الرئيسية</a>
          <a href="publish-ride.html">نشر رحلة</a>
          <a href="available-requests.html" class="active">طلبات الركاب</a>
          <a href="my-rides.html">رحلاتي</a>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="page-header">
        <h1 class="page-title">طلبات الركاب المتاحة</h1>
      </div>

      <div class="filters">
        <div class="filter-row">
          <div class="filter-group">
            <label>من</label>
            <input type="text" id="fromFilter" placeholder="مثال: بغداد">
          </div>
          <div class="filter-group">
            <label>إلى</label>
            <input type="text" id="toFilter" placeholder="مثال: البصرة">
          </div>
          <div class="filter-group">
            <label>التاريخ</label>
            <input type="date" id="dateFilter">
          </div>
        </div>
      </div>

      <div id="requestsGrid" class="requests-grid">
        <!-- Requests will be loaded here -->
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        loadRequests();
        
        // Add event listeners for filters
        document.getElementById('fromFilter').addEventListener('input', loadRequests);
        document.getElementById('toFilter').addEventListener('input', loadRequests);
        document.getElementById('dateFilter').addEventListener('change', loadRequests);
      });

      function loadRequests() {
        const fromFilter = document.getElementById('fromFilter').value.toLowerCase();
        const toFilter = document.getElementById('toFilter').value.toLowerCase();
        const dateFilter = document.getElementById('dateFilter').value;

        const requests = JSON.parse(localStorage.getItem('rideRequests') || '[]');
        const filteredRequests = requests.filter(request => {
          const matchesFrom = !fromFilter || request.from.toLowerCase().includes(fromFilter);
          const matchesTo = !toFilter || request.to.toLowerCase().includes(toFilter);
          
          let matchesDate = true;
          if (dateFilter) {
            const requestDate = new Date(request.date);
            const filterDate = new Date(dateFilter);
            requestDate.setHours(0, 0, 0, 0);
            filterDate.setHours(0, 0, 0, 0);
            matchesDate = requestDate.getTime() === filterDate.getTime();
          }

          return !request.fulfilled && matchesFrom && matchesTo && matchesDate;
        });

        const requestsGrid = document.getElementById('requestsGrid');
        
        if (filteredRequests.length === 0) {
          requestsGrid.innerHTML = `
            <div class="no-requests">
              <i class="fas fa-search"></i>
              <p>لا توجد طلبات ركاب متاحة حالياً</p>
            </div>
          `;
          return;
        }

        requestsGrid.innerHTML = filteredRequests.map(request => `
          <div class="request-card">
            <div class="request-header">
              <div class="request-date">
                <i class="fas fa-calendar"></i>
                ${formatDate(request.date)}
              </div>
              <div class="request-seats">
                <i class="fas fa-users"></i>
                ${request.seats} مقاعد
              </div>
            </div>
            
            <div class="request-route">
              <div class="route-point">
                <i class="fas fa-map-marker-alt"></i>
                <strong>من:</strong> ${request.from}
              </div>
              <div class="route-point">
                <i class="fas fa-map-marker"></i>
                <strong>إلى:</strong> ${request.to}
              </div>
            </div>

            <a href="https://wa.me/${formatPhone(request.phone)}" class="whatsapp-btn" target="_blank">
              <i class="fab fa-whatsapp"></i>
              تواصل عبر واتساب
            </a>
          </div>
        `).join('');
      }

      function formatDate(dateStr) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateStr).toLocaleDateString('ar-IQ', options);
      }

      function formatPhone(phone) {
        // Remove any non-digit characters
        const digits = phone.replace(/\D/g, '');
        
        // If the number starts with 0, replace it with 964
        if (digits.startsWith('0')) {
          return '964' + digits.slice(1);
        }
        
        return digits;
      }
    </script>
  </body>
</html>
