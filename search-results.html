<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نتائج البحث | عالواهس</title>
  <meta name="description" content="عالواهس - نتائج البحث عن رحلات التوصيل المشترك بين المدن العراقية" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Noto Kufi Arabic', sans-serif;
    }

    body {
      background-color: #f8f9fa;
      min-height: 100vh;
    }

    .navbar {
      background: linear-gradient(135deg, #FF8C00, #FFA500);
      padding: 1.2rem;
      color: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .navbar-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 2rem;
      font-weight: 700;
      color: white;
      text-decoration: none;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .search-summary {
      background: white;
      padding: 1.5rem;
      border-radius: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
    }

    .search-summary h2 {
      color: #2d3436;
      margin-bottom: 1rem;
    }

    .summary-details {
      display: flex;
      gap: 2rem;
      color: #2d3436;
    }

    .summary-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .ride-card {
      background: white;
      border-radius: 15px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition: transform 0.2s;
    }

    .ride-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .ride-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .route-info {
      display: flex;
      gap: 1rem;
      align-items: center;
      font-size: 1.1rem;
      color: #2d3436;
    }

    .price {
      font-size: 1.2rem;
      font-weight: 600;
      color: #2d3436;
    }

    .ride-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
      color: #636e72;
    }

    .detail-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .contact-btn {
      background: linear-gradient(135deg, #FF8C00, #FFA500);
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      width: 100%;
      transition: transform 0.2s;
    }

    .contact-btn:hover {
      transform: translateY(-2px);
    }

    .no-results {
      text-align: center;
      padding: 3rem;
      background: white;
      border-radius: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .no-results h2 {
      color: #2d3436;
      margin-bottom: 1rem;
    }

    .no-results p {
      color: #636e72;
      margin-bottom: 1.5rem;
    }

    .suggest-ride-btn {
      background: linear-gradient(135deg, #FF8C00, #FFA500);
      color: white;
      text-decoration: none;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      display: inline-block;
      font-weight: 500;
      transition: transform 0.2s;
    }

    .suggest-ride-btn:hover {
      transform: translateY(-2px);
    }

    @media (max-width: 768px) {
      .summary-details {
        flex-direction: column;
        gap: 1rem;
      }

      .ride-details {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-content">
      <a href="index.html" class="logo">عالواهس</a>
    </div>
  </nav>

  <div class="container">
    <div class="search-summary">
      <h2>نتائج البحث</h2>
      <div class="summary-details">
        <div class="summary-item">
          <span>من:</span>
          <strong id="fromLocationText"></strong>
        </div>
        <div class="summary-item">
          <span>إلى:</span>
          <strong id="toLocationText"></strong>
        </div>
        <div class="summary-item">
          <span>التاريخ:</span>
          <strong id="travelDateText"></strong>
        </div>
      </div>
    </div>

    <div id="searchResults"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Get search parameters from URL
      const params = new URLSearchParams(window.location.search);
      const from = params.get('from');
      const to = params.get('to');
      const date = params.get('date');

      // Update summary
      document.getElementById('fromLocationText').textContent = from;
      document.getElementById('toLocationText').textContent = to;
      document.getElementById('travelDateText').textContent = new Date(date).toLocaleDateString('ar-IQ');

      // Load and display rides
      loadRides(from, to, date);
    });

    function loadRides(from, to, date) {
      // Get published rides from localStorage
      const rides = JSON.parse(localStorage.getItem('publishedRides') || '[]');
      
      // Filter rides based on search criteria
      const matchingRides = rides.filter(ride => {
        // Use rawDateTime for comparison since it's in ISO format
        const rideDate = new Date(ride.rawDateTime).toDateString();
        const searchDate = new Date(date).toDateString();
        return ride.from.toLowerCase() === from.toLowerCase() &&
               ride.to.toLowerCase() === to.toLowerCase() &&
               rideDate === searchDate;
      });

      const resultsContainer = document.getElementById('searchResults');
      
      if (matchingRides.length === 0) {
        resultsContainer.innerHTML = `
          <div class="no-results">
            <h2>لم نجد رحلات مطابقة</h2>
            <p>لم نجد رحلات تطابق معايير بحثك. يمكنك نشر رحلة جديدة وسيتم إخطار المسافرين المهتمين.</p>
            <a href="publish-ride.html" class="suggest-ride-btn">نشر رحلة</a>
          </div>
        `;
        return;
      }

      resultsContainer.innerHTML = matchingRides.map(ride => `
        <div class="ride-card">
          <div class="ride-header">
            <div class="route-info">
              <span>${ride.from}</span>
              <span>→</span>
              <span>${ride.to}</span>
            </div>
            <div class="price">${ride.price} د.ع</div>
          </div>
          
          <div class="ride-details">
            <div class="detail-item">
              <span>التاريخ:</span>
              <span>${ride.date}</span>
            </div>
            <div class="detail-item">
              <span>الوقت:</span>
              <span>${ride.time}</span>
            </div>
            <div class="detail-item">
              <span>نوع السيارة:</span>
              <span>${ride.car === 'suv' ? 'دفع رباعي' : 'صالون'}</span>
            </div>
            <div class="detail-item">
              <span>المقاعد المتوفرة:</span>
              <span>${ride.seats}</span>
            </div>
          </div>

          <button class="contact-btn" onclick="contactDriver('${ride.phone}', '${ride.from}', '${ride.to}', '${ride.rawDateTime}')">
            تواصل مع السائق
          </button>
        </div>
      `).join('');
    }

    function contactDriver(phone, from, to, date) {
      const message = encodeURIComponent(`السلام عليكم، شفت إعلان رحلتك من ${from} إلى ${to} بتاريخ ${new Date(date).toLocaleDateString('ar-IQ')}. هل ما زالت المقاعد متوفرة؟`);
      
      // Format phone number for WhatsApp URL
      let whatsappNumber = phone.replace(/\D/g, '');
      if (whatsappNumber.startsWith('00')) {
        whatsappNumber = whatsappNumber.substring(2);
      }
      if (whatsappNumber.startsWith('0')) {
        whatsappNumber = '964' + whatsappNumber.substring(1);
      }
      if (!whatsappNumber.startsWith('964')) {
        whatsappNumber = '964' + whatsappNumber;
      }
      
      window.open(`https://api.whatsapp.com/send?phone=${whatsappNumber}&text=${message}`, '_blank');
    }
  </script>
</body>
</html>
